# Get requested VMs
$vms = Get-VM (Get-Content "C:\temp\VM.txt") 


	foreach ($vm in $vms) {

# Shutdown and wait some time
Shutdown-VMGuest -VM $vm -Confirm:$false
}

sleep 120

# For each VM, perform proper actions
foreach ($vm in $vms) {
# Not sure if snapshot is really needed, I just respect previous code. IMO, Iâ€™d skip this
# New-Snapshot -VM $vm -Memory:$false -Name "Before virtual HW upgrade"
# Change VM config
Set-VM -VM $vm -memoryMB ($vm.memoryMB + 8192) -Confirm:$false
}

sleep 120

foreach ($vm in $vms) {

# Start VM
Start-VM -VM $vm -Confirm:$false
}
